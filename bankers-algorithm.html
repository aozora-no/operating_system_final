<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banker's Algorithm Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 15px 40px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-label {
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 14px;
            min-width: 150px;
            text-align: center;
        }

        .status-safe {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .status-unsafe {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .status-ready {
            background: #e2e3e5;
            color: #383d41;
            border: 2px solid #d6d8db;
        }

        .setup-section {
            padding: 25px 40px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .setup-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .setup-row:last-child {
            margin-bottom: 0;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group label {
            font-weight: 600;
            color: #495057;
        }

        .input-group input {
            width: 80px;
            padding: 8px 12px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #117a8b;
        }

        .example-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .example-btn-small {
            padding: 8px 15px;
            font-size: 13px;
        }

        .tables-section {
            padding: 25px 40px;
            background: white;
            border-bottom: 1px solid #dee2e6;
        }

        .tables-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .table-wrapper {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }

        .table-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 2px solid #e9ecef;
            font-weight: 600;
            color: #495057;
            flex-shrink: 0;
        }

        .table-header h3 {
            font-size: 16px;
            margin: 0;
        }

        .table-container {
            overflow-x: auto;
            flex: 1;
            min-height: 150px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 400px;
        }

        table.many-columns th:not(:first-child),
        table.many-columns td:not(:first-child) {
            min-width: 80px;
            max-width: 120px;
        }

        table th:first-child,
        table td:first-child {
            position: sticky;
            left: 0;
            background: #f1f3f5;
            z-index: 1;
            min-width: 60px;
        }

        table.many-columns th:first-child,
        table.many-columns td:first-child {
            min-width: 80px;
        }

        th {
            background: #f1f3f5;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #495057;
            border: 1px solid #dee2e6;
            white-space: nowrap;
        }

        td {
            padding: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            white-space: nowrap;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px 4px;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
            transition: border-color 0.3s;
            min-width: 50px;
            box-sizing: border-box;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #007bff;
        }

        .need-cell {
            padding: 8px;
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .results-section {
            padding: 25px 40px;
            background: #f8f9fa;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-header h2 {
            color: #495057;
            font-size: 20px;
        }

        .results-output {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        @media (max-width: 768px) {
            .setup-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .example-buttons {
                justify-content: center;
            }
            
            .tables-container {
                grid-template-columns: 1fr;
            }
            
            .header, .status-bar, .setup-section, .tables-section, .results-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Banker's Algorithm Simulator</h1>
            <p>Deadlock Prevention Algorithm</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div>Status:</div>
            <div id="status" class="status-label status-ready">READY</div>
            <div id="status-message">Enter system configuration to begin</div>
        </div>

        <!-- Setup Section -->
        <div class="setup-section">
            <div class="setup-row">
                <div class="input-group">
                    <label>Processes:</label>
                    <input type="number" id="processes" min="1" max="10" value="3">
                </div>
                <div class="input-group">
                    <label>Resources:</label>
                    <input type="number" id="resources" min="1" max="8" value="3">
                </div>
                <button class="btn btn-primary" onclick="createTables()">
                    Create Tables
                </button>
                <button class="btn btn-info" onclick="generateRandomExample()">
                    Random Example
                </button>
            </div>
            <div class="setup-row">
                <div class="example-buttons">
                    <span style="font-weight: 600; margin-right: 10px; color: #495057;">Safe Examples:</span>
                    <button class="btn btn-success example-btn-small" onclick="loadSafeExample()">
                        Simple Safe
                    </button>
                    <button class="btn btn-success example-btn-small" onclick="loadClassicSafeExample()">
                        Classic Safe
                    </button>
                    <button class="btn btn-success example-btn-small" onclick="loadResourceRichExample()">
                        Resource Rich
                    </button>
                </div>
            </div>
            <div class="setup-row">
                <div class="example-buttons">
                    <span style="font-weight: 600; margin-right: 10px; color: #495057;">Deadlock Examples:</span>
                    <button class="btn btn-danger example-btn-small" onclick="loadDeadlockExample()">
                        Simple Deadlock
                    </button>
                    <button class="btn btn-danger example-btn-small" onclick="loadClassicDeadlockExample()">
                        Classic Deadlock
                    </button>
                    <button class="btn btn-danger example-btn-small" onclick="loadResourceStarvationExample()">
                        Resource Starvation
                    </button>
                </div>
            </div>
        </div>

        <!-- Tables Section -->
        <div class="tables-section">
            <h2>System State</h2>
            <div class="tables-container" id="tables-container">
                <!-- Tables will be generated here -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-success" onclick="updateAllData()">
                    Update All Tables
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
            <div class="results-header">
                <h2>Algorithm Results</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="clearResults()">
                        Clear Results
                    </button>
                    <button class="btn btn-warning" onclick="explainAlgorithm()">
                        Explain Algorithm
                    </button>
                </div>
            </div>
            <div class="results-output" id="results-output">
                Welcome to Banker's Algorithm Simulator!

                Instructions:
                1. Enter number of processes and resources
                2. Click "Create Tables"
                3. Enter values in the tables
                4. Click "Update All Tables"
                5. Click "Check Safe State" to run the algorithm
                
                Need = Max - Allocation (calculated automatically)
                
                Use example buttons to load different scenarios!
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-success" onclick="checkSafety()">
                    Check Safe State
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let numProcesses = 3;
        let numResources = 3;
        let allocation = [];
        let max = [];
        let need = [];
        let available = [];

        // Initialize with zeros
        function initZeroData() {
            allocation = Array(numProcesses).fill().map(() => Array(numResources).fill(0));
            max = Array(numProcesses).fill().map(() => Array(numResources).fill(0));
            need = Array(numProcesses).fill().map(() => Array(numResources).fill(0));
            available = Array(numResources).fill(0);
        }

        // Calculate Need = Max - Allocation
        function calculateNeedMatrix() {
            need = [];
            for (let i = 0; i < numProcesses; i++) {
                need[i] = [];
                for (let j = 0; j < numResources; j++) {
                    need[i][j] = max[i][j] - allocation[i][j];
                    if (need[i][j] < 0) need[i][j] = 0;
                }
            }
        }

        // Create the tables UI
        function createTables(populateWithCurrentData = true) {
            try {
                numProcesses = parseInt(document.getElementById('processes').value);
                numResources = parseInt(document.getElementById('resources').value);
                
                if (numProcesses <= 0 || numResources <= 0 || isNaN(numProcesses) || isNaN(numResources)) {
                    alert("Please enter valid positive numbers!");
                    return;
                }
                
                if (numResources > 8) {
                    numResources = 8;
                    document.getElementById('resources').value = 8;
                }
                
                if (numProcesses > 10) {
                    numProcesses = 10;
                    document.getElementById('processes').value = 10;
                }
                
                // Initialize arrays if they don't match the new dimensions
                if (allocation.length !== numProcesses || allocation[0]?.length !== numResources) {
                    initZeroData();
                }
                
                const tablesContainer = document.getElementById('tables-container');
                const isManyResources = numResources >= 5;
                
                tablesContainer.innerHTML = `
                    <!-- Available Resources -->
                    <div class="table-wrapper">
                        <div class="table-header">
                            <h3>Available Resources</h3>
                        </div>
                        <div class="table-container">
                            <table id="available-table" ${isManyResources ? 'class="many-columns"' : ''}>
                                <thead>
                                    <tr>
                                        ${Array.from({length: numResources}, (_, j) => `<th>R${j}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        ${Array.from({length: numResources}, (_, j) => 
                                            `<td><input type="number" id="avail-${j}" value="${populateWithCurrentData ? available[j] : 0}" min="0"></td>`
                                        ).join('')}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Allocation Table -->
                    <div class="table-wrapper">
                        <div class="table-header">
                            <h3>Allocation Matrix</h3>
                        </div>
                        <div class="table-container">
                            <table id="allocation-table" ${isManyResources ? 'class="many-columns"' : ''}>
                                <thead>
                                    <tr>
                                        <th>Process</th>
                                        ${Array.from({length: numResources}, (_, j) => `<th>R${j}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Array.from({length: numProcesses}, (_, i) => `
                                        <tr>
                                            <td><strong>P${i}</strong></td>
                                            ${Array.from({length: numResources}, (_, j) => `
                                                <td><input type="number" id="alloc-${i}-${j}" value="${populateWithCurrentData ? allocation[i][j] : 0}" min="0"></td>
                                            `).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Max Table -->
                    <div class="table-wrapper">
                        <div class="table-header">
                            <h3>Maximum Need Matrix</h3>
                        </div>
                        <div class="table-container">
                            <table id="max-table" ${isManyResources ? 'class="many-columns"' : ''}>
                                <thead>
                                    <tr>
                                        <th>Process</th>
                                        ${Array.from({length: numResources}, (_, j) => `<th>R${j}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Array.from({length: numProcesses}, (_, i) => `
                                        <tr>
                                            <td><strong>P${i}</strong></td>
                                            ${Array.from({length: numResources}, (_, j) => `
                                                <td><input type="number" id="max-${i}-${j}" value="${populateWithCurrentData ? max[i][j] : 0}" min="0"></td>
                                            `).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Need Table -->
                    <div class="table-wrapper">
                        <div class="table-header">
                            <h3>Need Matrix (Max - Allocation)</h3>
                        </div>
                        <div class="table-container">
                            <table id="need-table" ${isManyResources ? 'class="many-columns"' : ''}>
                                <thead>
                                    <tr>
                                        <th>Process</th>
                                        ${Array.from({length: numResources}, (_, j) => `<th>R${j}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Array.from({length: numProcesses}, (_, i) => `
                                        <tr>
                                            <td><strong>P${i}</strong></td>
                                            ${Array.from({length: numResources}, (_, j) => `
                                                <td><div id="need-${i}-${j}" class="need-cell">${populateWithCurrentData ? (max[i][j] - allocation[i][j]) : 0}</div></td>
                                            `).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                // If we have data, update the need table properly
                if (populateWithCurrentData) {
                    calculateNeedMatrix();
                    updateNeedTable();
                }
                
                updateStatus("Tables Created", "ready");
                addToResults("Tables created for " + numProcesses + " processes and " + numResources + " resources\n");
                
            } catch (error) {
                console.error("Error in createTables:", error);
                alert("Error creating tables. Please check your inputs and try again.");
            }
        }

        // ========== LOAD EXAMPLE FUNCTIONS ==========

        // Simple deadlock example
        function loadDeadlockExample() {
            numProcesses = 3;
            numResources = 3;
            
            document.getElementById('processes').value = numProcesses;
            document.getElementById('resources').value = numResources;
            
            allocation = [
                [1, 0, 1],
                [1, 1, 0],
                [0, 1, 1]
            ];
            
            max = [
                [2, 1, 1],
                [1, 2, 1],
                [1, 1, 2]
            ];
            
            available = [0, 0, 0];
            
            // Create tables with this data
            createTables(true);
            
            clearResults();
            addToResults("SIMPLE DEADLOCK EXAMPLE:\n");
            addToResults("=".repeat(50) + "\n\n");
            addToResults("Classic circular wait scenario:\n");
            addToResults("P0 holds R0,R2 and needs R1\n");
            addToResults("P1 holds R0,R1 and needs R2\n");
            addToResults("P2 holds R1,R2 and needs R0\n");
            addToResults("No resources available - Circular Wait!\n");
            updateStatus("Deadlock Example", "unsafe");
        }

        // Classic deadlock example
        function loadClassicDeadlockExample() {
            numProcesses = 5;
            numResources = 5;
            
            document.getElementById('processes').value = numProcesses;
            document.getElementById('resources').value = numResources;
            
            allocation = [
                [1, 0, 0, 0, 1],
                [0, 1, 0, 0, 0],
                [0, 0, 1, 0, 0],
                [0, 0, 0, 1, 0],
                [0, 0, 0, 0, 0]
            ];
            
            max = [
                [2, 1, 0, 0, 1],
                [0, 2, 1, 0, 0],
                [0, 0, 2, 1, 0],
                [1, 0, 0, 2, 0],
                [0, 0, 0, 0, 2]
            ];
            
            available = [0, 0, 0, 0, 0];
            
            createTables(true);
            
            clearResults();
            addToResults("CLASSIC DEADLOCK (Dining Philosophers):\n");
            addToResults("=".repeat(50) + "\n\n");
            addToResults("Each philosopher needs two chopsticks to eat:\n");
            addToResults("Circular wait: P0→P1→P2→P3→P0\n");
            addToResults("All resources held, none available!\n");
            updateStatus("Classic Deadlock", "unsafe");
        }

        // Resource starvation example
        function loadResourceStarvationExample() {
            numProcesses = 4;
            numResources = 3;
            
            document.getElementById('processes').value = numProcesses;
            document.getElementById('resources').value = numResources;
            
            allocation = [
                [2, 0, 0],
                [0, 2, 0],
                [0, 0, 2],
                [0, 0, 0]
            ];
            
            max = [
                [3, 2, 2],
                [2, 3, 2],
                [2, 2, 3],
                [1, 1, 1]
            ];
            
            available = [0, 0, 1];
            
            createTables(true);
            
            clearResults();
            addToResults("RESOURCE STARVATION EXAMPLE:\n");
            addToResults("=".repeat(50) + "\n\n");
            addToResults("System appears to have resources, but:\n");
            addToResults("No single process can complete with available resources.\n");
            addToResults("This leads to starvation - processes wait indefinitely!\n");
            updateStatus("Resource Starvation", "unsafe");
        }

        // Simple safe example
        function loadSafeExample() {
            numProcesses = 5;
            numResources = 3;
            
            document.getElementById('processes').value = numProcesses;
            document.getElementById('resources').value = numResources;
            
            allocation = [
                [0, 1, 0],
                [2, 0, 0],
                [3, 0, 2],
                [2, 1, 1],
                [0, 0, 2]
            ];
            
            max = [
                [7, 5, 3],
                [3, 2, 2],
                [9, 0, 2],
                [4, 3, 3],
                [5, 3, 3]
            ];
            
            available = [3, 3, 2];
            
            createTables(true);
            
            clearResults();
            addToResults("SIMPLE SAFE EXAMPLE:\n");
            addToResults("=".repeat(50) + "\n\n");
            addToResults("Classic safe state from OS textbooks.\n");
            addToResults("Safe sequence exists: P1 → P3 → P4 → P0 → P2\n");
            updateStatus("Safe Example", "safe");
        }

        // Classic safe example
        function loadClassicSafeExample() {
            numProcesses = 4;
            numResources = 3;
            
            document.getElementById('processes').value = numProcesses;
            document.getElementById('resources').value = numResources;
            
            allocation = [
                [0, 0, 1],
                [2, 0, 0],
                [0, 1, 0],
                [1, 0, 0]
            ];
            
            max = [
                [0, 0, 2],
                [3, 1, 0],
                [1, 2, 1],
                [2, 1, 1]
            ];
            
            available = [2, 1, 1];
            
            createTables(true);
            
            clearResults();
            addToResults("CLASSIC SAFE EXAMPLE:\n");
            addToResults("=".repeat(50) + "\n\n");
            addToResults("Very clear progression:\n");
            addToResults("P0 can finish immediately (needs only 1 more R2)\n");
            addToResults("Safe sequence: P0 → P2 → P3 → P1\n");
            updateStatus("Classic Safe", "safe");
        }

        // Resource-rich example
        function loadResourceRichExample() {
            numProcesses = 5;
            numResources = 4;
            
            document.getElementById('processes').value = numProcesses;
            document.getElementById('resources').value = numResources;
            
            allocation = [
                [1, 2, 0, 1],
                [0, 1, 1, 0],
                [2, 0, 0, 1],
                [1, 1, 0, 0],
                [0, 0, 1, 2]
            ];
            
            max = [
                [3, 3, 2, 2],
                [1, 2, 2, 1],
                [3, 1, 1, 2],
                [2, 2, 1, 1],
                [1, 1, 2, 3]
            ];
            
            available = [5, 4, 3, 4];
            
            createTables(true);
            
            clearResults();
            addToResults("RESOURCE-RICH EXAMPLE:\n");
            addToResults("=".repeat(50) + "\n\n");
            addToResults("Plenty of resources available:\n");
            addToResults("Available: [5, 4, 3, 4]\n");
            addToResults("Any process can finish immediately!\n");
            addToResults("Multiple safe sequences exist.\n");
            updateStatus("Resource Rich", "safe");
        }

        // Generate random example
        function generateRandomExample() {
            numProcesses = parseInt(document.getElementById('processes').value);
            numResources = parseInt(document.getElementById('resources').value);
            
            // Initialize arrays
            allocation = Array(numProcesses).fill().map(() => Array(numResources).fill(0));
            max = Array(numProcesses).fill().map(() => Array(numResources).fill(0));
            available = Array(numResources).fill(0);
            
            // Generate random allocation (0-2)
            for (let i = 0; i < numProcesses; i++) {
                for (let j = 0; j < numResources; j++) {
                    allocation[i][j] = Math.floor(Math.random() * 3);
                }
            }
            
            // Generate max (allocation + 1 to 4)
            for (let i = 0; i < numProcesses; i++) {
                for (let j = 0; j < numResources; j++) {
                    max[i][j] = allocation[i][j] + Math.floor(Math.random() * 4) + 1;
                }
            }
            
            // Generate available resources
            for (let j = 0; j < numResources; j++) {
                let totalAlloc = 0;
                for (let i = 0; i < numProcesses; i++) {
                    totalAlloc += allocation[i][j];
                }
                available[j] = totalAlloc + Math.floor(Math.random() * 3) + 2;
            }
            
            calculateNeedMatrix();
            createTables(true);
            
            clearResults();
            addToResults("Random example generated!\n");
            addToResults("Available: [" + available.join(", ") + "]\n\n");
            updateStatus("Example Generated", "info");
        }

        // ========== HELPER FUNCTIONS ==========

        // Update need table based on current data
        function updateNeedTable() {
            calculateNeedMatrix();
            for (let i = 0; i < numProcesses; i++) {
                for (let j = 0; j < numResources; j++) {
                    const cell = document.getElementById(`need-${i}-${j}`);
                    if (cell) {
                        cell.textContent = need[i][j];
                    }
                }
            }
        }

        // Update all data from UI
        function updateAllData() {
            try {
                // Get available resources
                for (let j = 0; j < numResources; j++) {
                    const input = document.getElementById(`avail-${j}`);
                    if (input) {
                        available[j] = parseInt(input.value) || 0;
                    }
                }
                
                // Get allocation matrix
                allocation = [];
                for (let i = 0; i < numProcesses; i++) {
                    allocation[i] = [];
                    for (let j = 0; j < numResources; j++) {
                        const input = document.getElementById(`alloc-${i}-${j}`);
                        allocation[i][j] = parseInt(input.value) || 0;
                    }
                }
                
                // Get max matrix
                max = [];
                for (let i = 0; i < numProcesses; i++) {
                    max[i] = [];
                    for (let j = 0; j < numResources; j++) {
                        const input = document.getElementById(`max-${i}-${j}`);
                        max[i][j] = parseInt(input.value) || 0;
                    }
                }
                
                // Calculate and update need matrix
                calculateNeedMatrix();
                updateNeedTable();
                
                addToResults("✓ All values updated!\n");
                addToResults("Available resources: [" + available.join(", ") + "]\n\n");
                updateStatus("Updated", "info");
                
            } catch (error) {
                alert("Error updating data. Please check all inputs are valid numbers.");
            }
        }

        // Check system safety using Banker's Algorithm
        function checkSafety() {
            if (!allocation || allocation.length === 0) {
                alert("Please create tables and enter data first!");
                return;
            }
            
            // Make sure we have latest data
            updateAllData();
            
            // Check for invalid data
            for (let i = 0; i < numProcesses; i++) {
                for (let j = 0; j < numResources; j++) {
                    if (allocation[i][j] > max[i][j]) {
                        addToResults("ERROR: Allocation cannot exceed Maximum for P" + i + ", R" + j + "\n");
                        updateStatus("Invalid Data", "unsafe");
                        return;
                    }
                }
            }
            
            addToResults("\n" + "=".repeat(60) + "\n");
            addToResults("RUNNING BANKER'S ALGORITHM\n");
            addToResults("=".repeat(60) + "\n\n");
            
            addToResults("Initial State:\n");
            addToResults("Available resources: [" + available.join(", ") + "]\n\n");
            
            addToResults("Step-by-step analysis:\n");
            
            // Banker's Algorithm implementation
            const work = [...available];
            const finish = Array(numProcesses).fill(false);
            const safeSequence = [];
            
            let step = 1;
            let found;
            
            do {
                found = false;
                addToResults("\nStep " + step + " (Work = [" + work.join(", ") + "]):\n");
                
                for (let i = 0; i < numProcesses; i++) {
                    if (!finish[i]) {
                        let canFinish = true;
                        for (let j = 0; j < numResources; j++) {
                            if (need[i][j] > work[j]) {
                                canFinish = false;
                                break;
                            }
                        }
                        
                        if (canFinish) {
                            addToResults("  P" + i + " can finish (Need[" + need[i].join(", ") + "] <= Work)\n");
                            
                            // Process finishes and releases resources
                            for (let j = 0; j < numResources; j++) {
                                work[j] += allocation[i][j];
                            }
                            
                            finish[i] = true;
                            safeSequence.push(i);
                            found = true;
                            
                            addToResults("     Releases resources -> New Work = [" + work.join(", ") + "]\n");
                            break;
                        } else {
                            addToResults("  P" + i + " must wait (Need[" + need[i].join(", ") + "] > Work)\n");
                        }
                    }
                }
                step++;
            } while (found);
            
            // Check if all processes finished
            let allFinished = true;
            let deadlockedProcesses = [];
            
            for (let i = 0; i < numProcesses; i++) {
                if (!finish[i]) {
                    allFinished = false;
                    deadlockedProcesses.push(i);
                }
            }
            
            addToResults("\n" + "=".repeat(60) + "\n");
            addToResults("FINAL RESULT:\n");
            
            if (allFinished) {
                addToResults("SAFE STATE!\n\n");
                addToResults("Safe execution sequence: ");
                addToResults(safeSequence.map(p => "P" + p).join(" -> ") + "\n");
                addToResults("All processes can complete without deadlock.\n");
                updateStatus("SAFE", "safe");
            } else {
                addToResults("UNSAFE STATE - POTENTIAL DEADLOCK!\n\n");
                addToResults("Deadlocked processes: P" + deadlockedProcesses.join(", P") + "\n");
                updateStatus("UNSAFE", "unsafe");
            }
            addToResults("=".repeat(60) + "\n\n");
            
            // Auto-scroll to bottom
            document.getElementById('results-output').scrollTop = document.getElementById('results-output').scrollHeight;
        }

        // Explain the algorithm steps
        function explainAlgorithm() {
            clearResults();
            addToResults("BANKER'S ALGORITHM EXPLANATION\n");
            addToResults("=".repeat(50) + "\n\n");
            
            addToResults("The Banker's Algorithm prevents deadlock by:\n\n");
            addToResults("1. Need Matrix = Max - Allocation\n");
            addToResults("2. Start with Work = Available resources\n");
            addToResults("3. Find a process where Need <= Work\n");
            addToResults("4. If found, assume it finishes and releases resources\n");
            addToResults("5. Add released resources to Work\n");
            addToResults("6. Repeat until all processes finish (SAFE) or no progress (UNSAFE)\n\n");
            
            addToResults("DEADLOCK CONDITIONS (All 4 must be present):\n");
            addToResults("1. Mutual Exclusion - Resources cannot be shared\n");
            addToResults("2. Hold and Wait - Processes hold resources while waiting\n");
            addToResults("3. No Preemption - Resources cannot be taken away\n");
            addToResults("4. Circular Wait - Processes waiting for each other\n");
        }

        // Update status display
        function updateStatus(message, type) {
            const statusElement = document.getElementById('status');
            const statusMessage = document.getElementById('status-message');
            
            statusElement.textContent = message;
            statusElement.className = 'status-label';
            
            switch(type) {
                case 'safe':
                    statusElement.classList.add('status-safe');
                    statusMessage.textContent = 'System is in a safe state';
                    break;
                case 'unsafe':
                    statusElement.classList.add('status-unsafe');
                    statusMessage.textContent = 'System is unsafe - potential deadlock';
                    break;
                case 'info':
                    statusElement.classList.add('status-ready');
                    statusMessage.textContent = 'Ready for analysis';
                    break;
                default:
                    statusElement.classList.add('status-ready');
                    statusMessage.textContent = message;
            }
        }

        // Add message to results output
        function addToResults(message) {
            const resultsOutput = document.getElementById('results-output');
            resultsOutput.textContent += message;
        }

        // Clear results output
        function clearResults() {
            document.getElementById('results-output').textContent = '';
            updateStatus("Ready", "ready");
        }

        // Initialize on page load
        window.onload = function() {
            initZeroData();
            createTables(false);
            addToResults("System initialized. Ready to begin!\n");
        };
    </script>
</body>
</html>