<!DOCTYPE html>
<html>
<head>
    <title>CPU Scheduling Simulation</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        table {
            width: 600px;
            margin: 20px auto;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th { background-color: #ddd; }

        input {
            width: 90%;
            padding: 5px;
            text-align: center;
        }

        button {
            padding: 10px 18px;
            margin: 6px;
            cursor: pointer;
        }

        #ganttChart, #timeScale {
            display: flex;
            margin-top: 20px;
            align-items: center;
        }

        .gantt-block {
            border: 1px solid black;
            background: lightblue;
            font-weight: bold;
            padding: 10px 0;
            opacity: 0;
            transform: translateY(20px);
            transition: 0.5s ease;
            text-align: center;
        }

        .gantt-block.show {
            opacity: 1;
            transform: translateY(0);
        }

        #timeScale span {
            font-weight: bold;
        }
    </style>
</head>

<body>

<h2>CPU Scheduling Simulator</h2>

<table id="inputTable">
    <tr>
        <th>Process</th>
        <th>Arrival Time</th>
        <th>Burst Time</th>
    </tr>
    <tr>
        <td>P1</td>
        <td><input type="number" class="at" value="0"></td>
        <td><input type="number" class="bt" value="0"></td>
    </tr>
    <tr>
        <td>P2</td>
        <td><input type="number" class="at" value="0"></td>
        <td><input type="number" class="bt" value="0"></td>
    </tr>
    <tr>
        <td>P3</td>
        <td><input type="number" class="at" value="0"></td>
        <td><input type="number" class="bt" value="0"></td>
    </tr>
    <tr>
        <td>P4</td>
        <td><input type="number" class="at" value="0"></td>
        <td><input type="number" class="bt" value="0"></td>
    </tr>
</table>

<div>
    <button onclick="addProcess()">Add Process</button>
    <button onclick="removeProcess()">Remove Process</button>
</div>

<div>
    <button onclick="runFCFS()">Generate FCFS</button>
    <button onclick="runSJF()">Generate SJF</button>
</div>

<h3>Gantt Chart</h3>
<div id="ganttChart"></div>
<div id="timeScale"></div>

<h3>Results Table</h3>
<table id="resultsTable"></table>

<script>
/* -------- ADD / REMOVE -------- */
function addProcess() {
    const table = document.getElementById("inputTable");
    const rowCount = table.rows.length;
    const row = table.insertRow();
    row.innerHTML = `
        <td>P${rowCount}</td>
        <td><input type="number" class="at" value="0"></td>
        <td><input type="number" class="bt" value="1"></td>
    `;
}

function removeProcess() {
    const table = document.getElementById("inputTable");
    if (table.rows.length > 2) table.deleteRow(-1);
    else alert("At least one process is required.");
}

/* -------- INPUT -------- */
function getTableData() {
    const at = [...document.querySelectorAll(".at")].map(x => parseInt(x.value));
    const bt = [...document.querySelectorAll(".bt")].map(x => parseInt(x.value));
    
    // Validate for non-numeric or invalid input
    if (at.some(isNaN) || bt.some(isNaN)) {
        alert("Invalid input detected. Please make sure Arrival Time and Burst Time are numbers.");
        throw new Error("Invalid input detected");
    }
    
    return { processes: bt.map((_, i) => i + 1), arrival: at, burst: bt };
}

/* -------- FCFS -------- */
function FCFS(processes, arrival, burst) {
    let gantt = [];
    let time = 0;
    let wt = [], tat = [];

    for (let i = 0; i < processes.length; i++) {
        // Skip idle time and directly process the next arrival
        if (time < arrival[i]) {
            time = arrival[i];
        }

        gantt.push({ p: "P" + processes[i], start: time, end: time + burst[i] });
        time += burst[i];

        tat[i] = time - arrival[i];
        wt[i] = tat[i] - burst[i];
    }
    return { gantt, wt, tat, processes, arrival, burst };
}

/* -------- SJF (NON-PREEMPTIVE) -------- */
function SJF(arrival, burst) {
    let n = arrival.length;
    let time = 0, completed = 0;
    let remaining = burst.slice();
    let wt = Array(n).fill(0);
    let tat = Array(n).fill(0);
    let gantt = [];

    while (completed < n) {
        let idx = -1, minBT = Infinity;
        for (let i = 0; i < n; i++) {
            if (arrival[i] <= time && remaining[i] > 0 && remaining[i] < minBT) {
                minBT = remaining[i];
                idx = i;
            }
        }

        // Skip idle time and directly process the next arrival
        if (idx === -1) {
            time = Math.min(...arrival.filter((a, i) => remaining[i] > 0));
            continue;
        }

        gantt.push({ p: "P" + (idx + 1), start: time, end: time + remaining[idx] });
        time += remaining[idx];

        tat[idx] = time - arrival[idx];
        wt[idx] = tat[idx] - burst[idx];
        remaining[idx] = 0;
        completed++;
    }

    return {
        gantt,
        wt,
        tat,
        processes: burst.map((_, i) => i + 1),
        arrival,
        burst
    };
}

/* -------- GANTT -------- */
function createGanttChart(gantt) {
    const chart = document.getElementById("ganttChart");
    const scale = document.getElementById("timeScale");
    chart.innerHTML = scale.innerHTML = "";

    gantt.forEach((b, i) => {
        const d = document.createElement("div");
        d.className = "gantt-block";
        d.style.width = (b.end - b.start) * 40 + "px";
        d.textContent = b.p;
        chart.appendChild(d);
        setTimeout(() => d.classList.add("show"), i * 150);
    });

    gantt.forEach(b => {
        const s = document.createElement("span");
        s.style.display = "inline-block";
        s.style.width = (b.end - b.start) * 40 + "px";
        s.textContent = b.start;
        scale.appendChild(s);
    });

    const end = document.createElement("span");
    end.textContent = gantt[gantt.length - 1].end;
    scale.appendChild(end);
}

/* -------- RESULTS TABLE (UPDATED) -------- */
function displayTable(result) {
    const table = document.getElementById("resultsTable");

    let html = `
        <tr>
            <th>Process</th>
            <th>Arrival Time</th>
            <th>Burst Time</th>
            <th>Finish Time</th>
            <th>Turnaround Time</th>
            <th>Waiting Time</th>
        </tr>
    `;

    result.processes.forEach((p, i) => {
        const finish = result.arrival[i] + result.tat[i];
        html += `
            <tr>
                <td>P${p}</td>
                <td>${result.arrival[i]}</td>
                <td>${result.burst[i]}</td>
                <td>${finish}</td>
                <td>${result.tat[i]}</td>
                <td>${result.wt[i]}</td>
            </tr>
        `;
    });

    html += `
        <tr>
            <th colspan="4">AVERAGE</th>
            <th>${(result.tat.reduce((a,b)=>a+b)/result.tat.length).toFixed(2)}</th>
            <th>${(result.wt.reduce((a,b)=>a+b)/result.wt.length).toFixed(2)}</th>
        </tr>
    `;
    table.innerHTML = html;
}

/* -------- BUTTONS -------- */
function runFCFS() {
    const data = getTableData();
    const result = FCFS(data.processes, data.arrival, data.burst);
    createGanttChart(result.gantt);
    displayTable(result);
}

function runSJF() {
    const data = getTableData();
    const result = SJF(data.arrival, data.burst);
    createGanttChart(result.gantt);
    displayTable(result);
}
</script>

</body>
</html>